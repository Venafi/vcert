# Venafi Certificate and Key Policy Specification

The _Venafi Certificate and Key Policy Specification_ is a standard for defining 
constraints and recommendations that govern key generation and certificate issuance. 
The specification is consumable by the VCert CLI and VCert-based integrations like 
the [Venafi Collection for Ansible](https://github.com/Venafi/ansible-collection-venafi) 
and the [Venafi Provider for HashiCorp Terraform](https://github.com/Venafi/terraform-provider-venafi) 
that support Certificate Policy Management.

## Policy-as-Code Structure (JSON)

The structure of the _Venafi Certificate and Key Policy Specification_ is shown 
below and is the same starter policy that can be output by executing the `vcert 
getpolicy --starter` command. The specification has two sections, "policy" and 
"defaults". The "policy" section specifies values with which new certificate requests 
must comply and the "defaults" section specifies values that are recommended for use 
in certificate requests when those values are not specified or overridden. 
VCert also supports YAML formatted input specifications.

```json
{
  "policy": {
    "domains": [ "" ],
    "wildcardAllowed": false,
    "autoInstalled": false,
    "maxValidDays": 0,
    "certificateAuthority": "",
    "subject": {
      "orgs": [ "" ],
      "orgUnits": [ "" ],
      "localities": [ "" ],
      "states": [ "" ],
      "countries": [ "" ]
    },
    "keyPair": {
      "keyTypes": [ "" ],
      "rsaKeySizes": [ 0 ],
      "ellipticCurves": [ "" ],
      "serviceGenerated": false,
      "reuseAllowed": false
    },
    "subjectAltNames": {
      "dnsAllowed": false,
      "ipAllowed": false,
      "emailAllowed": false,
      "uriAllowed": false,
      "upnAllowed": false
    }
  },
  "defaults": {
    "domain": "",
    "subject": {
      "org": "",
      "orgUnits": [ "" ],
      "locality": "",
      "state": "",
      "country": ""
    },
    "keyPair": {
      "keyType": "",
      "rsaKeySize": 0,
      "ellipticCurve": "",
      "serviceGenerated": false
    }
  }
}
```

## Policy-as-Code Parameters

All parameters in a specification are optional thus `{}` is the most simple valid 
specification and results in a policy that uses TPP or VaaS defaults.

| &nbsp;&nbsp;&nbsp;Parameter&nbsp;&nbsp;&nbsp; | Data&nbsp;Type | Description |
| ---- | ---- | ---- |
| `policy` |||
| &nbsp;&nbsp;&nbsp;`domains` |string&nbsp;array| Specifies domain suffixes that are permitted in Common Name (CN) and DNS Subject Alternative Name (SAN) values |
| &nbsp;&nbsp;&nbsp;`wildcardAllowed` |boolean| Indicates whether CN and DNS SAN values may specify wildcards like "*.example.com" |
| &nbsp;&nbsp;&nbsp;`autoInstalled` |boolean| Indicates whether the requested certificate will be automatically installed (i.e. provisioned) ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg) |
| &nbsp;&nbsp;&nbsp;`maxValidDays` |integer| Number of days for which the requested certificate will be valid.  May be ignored if the integration with the issuing CA does not support specific end dates. |
| &nbsp;&nbsp;&nbsp;`certificateAuthority` |string| For TPP, the distinguished name of a CA Template object.  For example, "\VED\Policy\Certificate Authorites\Entrust Advantage".<br />For VaaS, CA Account Type ("DIGICERT", "ENTRUST", "GLOBALSIGN", or "BUILTIN"), CA Account Name (as it appears in the web console), and CA Product Type delimited by backslash characters.  For example, "DIGICERT\My DigiCert Account\ssl_plus". |
| &nbsp;&nbsp;&nbsp;`subject` |||
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`orgs` | string&nbsp;array | Organization (O) values that are permitted |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`orgUnits` | string&nbsp;array | Organizational Unit (OU) values that are permitted |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`localities` | string&nbsp;array | City/Locality (L) values that are permitted |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`states` | string&nbsp;array | State/Province (ST) values that are permitted |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`countries` | string&nbsp;array | 2-character ISO 3166 Country (C) values that are permitted |
| &nbsp; `keyPair` |||
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`keyTypes` | string&nbsp;array | Key algorithm: "RSA" and/or "ECDSA" ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg) |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`rsaKeySizes` | integer array | Permitted number of bits for RSA keys: 512, 1024, 2048, 3072, and/or 4096 |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`ellipticCurves` | string&nbsp;array | Permitted elliptic curves ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg): "P256", "P384", and/or "P521" |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`serviceGenerated` | boolean | Indicates whether key pair and CSR are generated by TPP or VaaS |
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`reuseAllowed` | boolean | Indicates whether new certificate requests are permitted to reuse a key pair of a known certificate |
| &nbsp;&nbsp;&nbsp;`subjectAltNames` |||
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`dnsAllowed` | boolean |Indicates whether DNS Subject Alternative Names are permitted|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`ipAllowed` | boolean |Indicates whether IP Address Subject Alternative Names are permitted ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg)|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`emailAllowed` | boolean |Indicates whether Email Address (RFC822) Subject Alternative Names are permitted ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg)|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`uriAllowed` | boolean |Indicates whether Uniform Resource Indicator (URI) Subject Alternative Names are permitted ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg)|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`upnAllowed` | boolean |Indicates whether User Principal Name (UPN) Subject Alternative Names are permitted ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg)|
| `defaults` |||
| &nbsp;&nbsp;&nbsp;`domain` |string|The domain suffix that should be used by default (e.g. "example.com")|
| &nbsp;&nbsp;&nbsp;`subject` |||
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`org` | string |The Organization (O) value that should be used by default (e.g. "Example, Inc.")|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`orgUnits` | string&nbsp;array |The Organizational Unit (OU) values that should be used by default (e.g. "Quality Assurance")|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`locality` | string |The City/Locality (L) value that should be used by default (e.g. "Salt Lake City")|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`state` | string |The State/Province (ST) value that should be used by default (e.g. "Utah")|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`country` | string |2-character ISO 3166 Country (C) value that should be used by default (e.g. "US")|
| &nbsp;&nbsp;&nbsp;`keyPair` |||
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`keyType` | string |The key algorithm that should be used by default, "RSA" or "ECDSA" ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg)|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`rsaKeySize` | integer |The number of bits that should be used by default for RSA keys: 512, 1024, 2048, 3072, or 4096|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`ellipticCurve` | string |The elliptic curve that should be used by default ![TPP Only](https://img.shields.io/badge/TPP%20Only-orange.svg): "P256", "P384", or "P521"|
| &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;`serviceGenerated` | boolean |Indicates whether keys should be generated by TPP by default|
